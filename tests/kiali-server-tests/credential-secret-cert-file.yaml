name: "credential_secret_cert_file"
description: "Verify cert_file secret preserves the secret key name in the mounted file path"
helm_args:
  - "--set"
  - "external_services.prometheus.auth.cert_file=secret:my-tls-certs:tls.crt"
yq_query: "select(.kind == \"Deployment\") | {\"volume\": (.spec.template.spec.volumes | map(select(.name == \"prometheus-cert\")) | .[0]), \"volumeMount\": (.spec.template.spec.containers[] | select(.name == \"kiali\") | .volumeMounts | map(select(.name == \"prometheus-cert\")) | .[0])}"
expected_result: |
  volume:
    name: prometheus-cert
    secret:
      secretName: my-tls-certs
      items:
        - key: tls.crt
          path: tls.crt
  volumeMount:
    name: prometheus-cert
    mountPath: "/kiali-override-secrets/prometheus-cert"
    readOnly: true
should_fail: false

