name: "credential_secret_customdashboards_disabled"
description: "Verify custom dashboards credentials are NOT mounted when custom_dashboards.enabled is false"
helm_args:
  - "--set"
  - "external_services.custom_dashboards.enabled=false"
  - "--set"
  - "external_services.custom_dashboards.prometheus.url=http://prometheus:9090"
  - "--set"
  - "external_services.custom_dashboards.prometheus.auth.username=secret:cd-prom-creds:user"
  - "--set"
  - "external_services.custom_dashboards.prometheus.auth.password=secret:cd-prom-creds:pass"
yq_query: "select(.kind == \"Deployment\") | (.spec.template.spec.volumes | map(select(.name | test(\"^customdashboards-prometheus\"))) | length)"
expected_result: |
  0
should_fail: false

