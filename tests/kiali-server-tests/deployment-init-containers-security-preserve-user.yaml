name: "init_containers_security_preserve_user"
description: "Verify mandatory guardrails are applied while preserving user securityContext fields on additional initContainers"
helm_args:
  - "--set"
  - "deployment.additional_pod_init_containers_yaml[0].name=extra-init"
  - "--set"
  - "deployment.additional_pod_init_containers_yaml[0].image=registry.access.redhat.com/ubi9/ubi-minimal:latest"
  - "--set"
  - "deployment.additional_pod_init_containers_yaml[0].command[0]=echo"
  - "--set"
  - "deployment.additional_pod_init_containers_yaml[0].command[1]=init"
  - "--set"
  - "deployment.additional_pod_init_containers_yaml[0].securityContext.runAsUser=2448"
  - "--set"
  - "deployment.additional_pod_init_containers_yaml[0].securityContext.seccompProfile.type=RuntimeDefault"
yq_query: "select(.kind == \"Deployment\") | .spec.template.spec.initContainers[0].securityContext"
expected_result: |
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  privileged: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 2448
  seccompProfile:
    type: RuntimeDefault
should_fail: false

