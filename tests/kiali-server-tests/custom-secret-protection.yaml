name: "custom_secret_protection"
description: "Verify custom secrets are also protected"
helm_args:
  - "--set"
  - "deployment.custom_secrets[0].name=my-custom-secret"
  - "--set"
  - "deployment.custom_secrets[0].mount=/custom"
  - "--set"
  - "deployment.additional_pod_containers_yaml[0].name=custom-init"
  - "--set"
  - "deployment.additional_pod_containers_yaml[0].image=registry.access.redhat.com/ubi9/ubi-minimal:latest"
  - "--set"
  - "deployment.additional_pod_containers_yaml[0].command[0]=echo"
  - "--set"
  - "deployment.additional_pod_containers_yaml[0].command[1]=test"
  - "--set"
  - "deployment.additional_pod_containers_yaml[0].volumeMounts[0].name=my-custom-secret"
  - "--set"
  - "deployment.additional_pod_containers_yaml[0].volumeMounts[0].mountPath=/test-custom"
yq_query: ".spec.template.spec.containers[0].volumeMounts"
expected_result: |
  - mountPath: /test-custom
    name: my-custom-secret
    readOnly: true
should_fail: false
