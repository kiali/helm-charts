name: "credential_secret_login_token"
description: "Verify login_token.signing_key with secret pattern is auto-mounted"
helm_args:
  - "--set"
  - "login_token.signing_key=secret:kiali-signing-key:key"
yq_query: "select(.kind == \"Deployment\") | {\"volume\": (.spec.template.spec.volumes | map(select(.name == \"login-token-signing-key\")) | .[0]), \"volumeMount\": (.spec.template.spec.containers[] | select(.name == \"kiali\") | .volumeMounts | map(select(.name == \"login-token-signing-key\")) | .[0])}"
expected_result: |
  volume:
    name: login-token-signing-key
    secret:
      secretName: kiali-signing-key
      items:
        - key: key
          path: value.txt
  volumeMount:
    name: login-token-signing-key
    mountPath: "/kiali-override-secrets/login-token-signing-key"
    readOnly: true
should_fail: false

