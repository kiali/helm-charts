name: "credential_secret_chatai_disabled"
description: "Verify chat_ai credentials are NOT mounted when chat_ai.enabled is false"
helm_args:
  - "--set"
  - "chat_ai.enabled=false"
  - "--set"
  - "chat_ai.default_provider=openai"
  - "--set"
  - "chat_ai.providers[0].name=openai"
  - "--set"
  - "chat_ai.providers[0].type=openai"
  - "--set"
  - "chat_ai.providers[0].config=default"
  - "--set"
  - "chat_ai.providers[0].enabled=true"
  - "--set"
  - "chat_ai.providers[0].default_model=gpt4"
  - "--set"
  - "chat_ai.providers[0].key=secret:ai-provider-creds:api-key"
  - "--set"
  - "chat_ai.providers[0].models[0].name=gpt4"
  - "--set"
  - "chat_ai.providers[0].models[0].model=gpt-4"
  - "--set"
  - "chat_ai.providers[0].models[0].enabled=true"
  - "--set"
  - "chat_ai.providers[0].models[0].key=secret:ai-model-creds:model-api-key"
yq_query: "select(.kind == \"Deployment\") | (.spec.template.spec.volumes | map(select(.name == \"chat-ai-provider-openai\" or .name == \"chat-ai-model-openai-gpt4\")) | length)"
expected_result: |
  0
should_fail: false
