name: "custom_secrets_basic"
description: "Verify custom secrets are mounted correctly"
helm_args:
  - "--set"
  - "deployment.custom_secrets[0].name=custom-secret-1"
  - "--set"
  - "deployment.custom_secrets[0].mount=/custom/mount/path"
  - "--set"
  - "deployment.custom_secrets[0].optional=true"
yq_query: "select(.kind == \"Deployment\") | {\"volume\": (.spec.template.spec.volumes | map(select(.name == \"custom-secret-1\")) | .[0].secret), \"volumeMount\": (.spec.template.spec.containers[0].volumeMounts | map(select(.name == \"custom-secret-1\")) | .[0])}"
expected_result: |
  volume:
    secretName: custom-secret-1
    optional: true
  volumeMount:
    name: custom-secret-1
    mountPath: "/custom/mount/path"
should_fail: false
