name: "credential_secret_prometheus_password"
description: "Verify prometheus password secret is auto-mounted when using secret:<name>:<key> pattern"
helm_args:
  - "--set"
  - "external_services.prometheus.auth.password=secret:my-prometheus-creds:password-key"
yq_query: "select(.kind == \"Deployment\") | {\"volume\": (.spec.template.spec.volumes | map(select(.name == \"prometheus-password\")) | .[0]), \"volumeMount\": (.spec.template.spec.containers[] | select(.name == \"kiali\") | .volumeMounts | map(select(.name == \"prometheus-password\")) | .[0])}"
expected_result: |
  volume:
    name: prometheus-password
    secret:
      secretName: my-prometheus-creds
      items:
        - key: password-key
          path: value.txt
  volumeMount:
    name: prometheus-password
    mountPath: "/kiali-override-secrets/prometheus-password"
    readOnly: true
should_fail: false

